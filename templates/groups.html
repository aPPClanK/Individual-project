<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Группы</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='groups.css') }}">
    <script>
        // Функция для открытия окна
        function openAttendance(studentId) {
            document.getElementById('overlay').style.display = 'block';
            fetch(`/get_attendance?student_id=${studentId}`)
                .then(response => response.json())
                .then(data => {
                    let attendanceTable = document.getElementById('attendance-table');
                    attendanceTable.innerHTML = `
                        <tr>
                            <th>Дата</th>
                            <th>Предмет</th>
                            <th>Статус</th>
                        </tr>
                    `;
                    data.forEach(item => {
                        let row = `
                            <tr>
                                <td>${item[0]}</td>
                                <td>${item[1]}</td>
                                <td>${item[2]}</td>
                            </tr>
                        `;
                        attendanceTable.innerHTML += row;
                    });
                });
        }
        // Функция для закрытия окна
        function closeAttendance() {
            document.getElementById('overlay').style.display = 'none';
        }
        // Функция для открытия окна добавления группы
        function openAddGroup() {
            document.getElementById('addGroupOverlay').style.display = 'block';
        }
        // Функция для закрытия окна добавления группы
        function closeAddGroup() {
            document.getElementById('addGroupOverlay').style.display = 'none';
        }
        // Функция для открытия окна добавления студента
        function openAddStudent() {
            document.getElementById('addStudentOverlay').style.display = 'block';
        }
        // Функция для закрытия окна добавления студента
        function closeAddStudent() {
            document.getElementById('addStudentOverlay').style.display = 'none';
        }
        // Функция для подтверждения удаления
        function confirmDelete(url) {
            if (confirm("Вы уверены, что хотите удалить это?")) {
                fetch(url, { method: 'POST' })
                    .then(response => {
                        if (response.ok) {
                            window.location.reload();
                        } else {
                            alert("Ошибка при удалении.");
                        }
                    });
            }
        }
    </script>
</head>
<body>
    <div class="dropdown">
        <button class="dropdownbutton"><i class="fa fa-list-ul" aria-hidden="true"></i></button>
        <div class="dropdown-menu">
            <a href="/">На главную</a>
            <a href="schedule">Расписание</a>
            <a href="teachers">Преподаватели</a>
        </div>
    </div>
    <div class="box">
        <h1>Список групп</h1>
        <table>
            <tr>
                <th class="name">Название группы</th>
                <th class="course">Курс</th>
                <th class="number">Количество студентов</th>
                <th class="action">Действия</th>
            </tr>
            {% for group in groups %}
            <tr class="row" {% if selected_group_id and selected_group_id == group[0]|string %}style="background-color: rgb(200,222,215);"{% endif %}>
                <td>{{ group[1] }}</td>
                <td>{{ group[2] }}</td>
                <td>{{ group[3] }}</td>
                <td class="show">
                    <button class="actions" onclick="window.location.href='/groups?group_id={{ group[0] }}'" style="display: block;">Показать студентов</button>
                    <button class="actions" onclick="confirmDelete('{{ url_for('delete_group', group_id=group[0]) }}')">Удалить группу</button>
                </td>
            </tr>
            {% endfor %}
        </table>
        <br>
        <button class="actions" onclick="openAddGroup()">Добавить группу</button>
    </div>
    <br>
    <div class="box">
        <h1>
            Список студентов
            {% if not show_all_students %}
                <button class="actions" onclick="window.location.href='/groups'">Показать всех студентов</button>
            {% endif %}
        </h1>
        <table class="students">
            <tr>
                <th class="s_name">Имя</th>
                <th class="s_fam">Фамилия</th>
                <th class="s_date">Дата рождения</th>
                <th class="s_gender">Пол</th>
                <th class="s_address">Адрес</th>
                <th class="s_tel">Телефон</th>
                <th class="s_email">Email</th>
                {% if show_all_students %}
                    <th class="s_group">Группа</th>
                {% else %}
                    <th class="s_group">Действия</th>
                {% endif %}
            </tr>
            {% for student in students %}
            <tr>
                <td>{{ student[1] }}</td>
                <td>{{ student[2] }}</td>
                <td>{{ student[3] }}</td>
                <td>{{ student[4] }}</td>
                <td>{{ student[5] }}</td>
                <td>{{ student[6] }}</td>
                <td>{{ student[7] }}</td>
                {% if show_all_students %}
                    <td>{{ student[8] }}</td>
                {% else %}
                    <td>
                        <button class="actions" onclick="openAttendance({{ student[0] }})">Посещаемость</button>
                        <button class="actions" onclick="confirmDelete('{{ url_for('delete_student', student_id=student[0]) }}')">Удалить студента</button>
                    </td>
                {% endif %}
            </tr>
            {% endfor %}
        </table>
        <br>
        {% if not show_all_students %}
            <button class="actions" onclick="openAddStudent()">Добавить студента</button>
        {% endif %}
    </div>
    <div class="overlay" id="overlay" onclick="closeAttendance()">
        <div class="modal" onclick="event.stopPropagation()">
            <h2 style="text-align: center;">Посещаемость</h2>
            <table id="attendance-table">
                <tr>
                    <th>Дата</th>
                    <th>Предмет</th>
                    <th>Статус</th>
                </tr>
            </table>
            <button class="actions" onclick="closeAttendance()">Закрыть</button>
        </div>
    </div>
    <div class="overlay" id="addGroupOverlay" onclick="closeAddGroup()">
        <div class="modal" onclick="event.stopPropagation()">
            <h2>Добавить группу</h2>
            <form action="{{ url_for('add_group') }}" method="POST">
                <label for="group_name">Название группы:</label>
                <input type="text" id="group_name" name="group_name" required>
                <label for="course_id">Курс:</label>
                <select id="course_id" name="course_id" required>
                    <option value="1">Курс 1</option>
                    <option value="2">Курс 2</option>
                </select>
                <button type="submit">Добавить</button>
                <button type="button" onclick="closeAddGroup()">Закрыть</button>
            </form>
        </div>
    </div>
    <div class="overlay" id="addStudentOverlay" onclick="closeAddStudent()">
        <div class="modal" onclick="event.stopPropagation()">
            <h2>Добавить студента</h2>
            <form action="{{ url_for('add_student') }}" method="POST">
                <input type="hidden" name="group_id" value="{{ selected_group_id }}">
                <label for="first_name">Имя:</label>
                <input type="text" id="first_name" name="first_name" required>
                <label for="last_name">Фамилия:</label>
                <input type="text" id="last_name" name="last_name" required>
                <label for="date_of_birth">Дата рождения:</label>
                <input type="date" id="date_of_birth" name="date_of_birth" required>
                <label for="gender">Пол:</label>
                <select id="gender" name="gender" required>
                    <option value="Male">Мужской</option>
                    <option value="Female">Женский</option>
                </select>
                <label for="address">Адрес:</label>
                <input type="text" id="address" name="address" required>
                <label for="phone">Телефон:</label>
                <input type="text" id="phone" name="phone" required>
                <label for="email">Email:</label>
                <input type="email" id="email" name="email" required>
                <button type="submit">Добавить</button>
                <button type="button" onclick="closeAddStudent()">Закрыть</button>
            </form>
        </div>
    </div>
</body>
</html>
